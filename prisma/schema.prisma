generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum AuthProvider {
  GOOGLE
  APPLE
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum PomodoroSessionState {
  FOCUS
  BREAK
  COMPLETED
  ABORTED
}

model users {
  id               String       @id @default(uuid())
  email            String       @unique @db.VarChar(255)
  auth_provider    AuthProvider @default(GOOGLE)
  auth_provider_id String
  status           UserStatus   @default(ACTIVE)
  created_at       DateTime     @default(now()) @db.Timestamptz
  updated_at       DateTime     @updatedAt @db.Timestamptz
  deleted_at       DateTime?    @db.Timestamptz

  // relations
  tasks            tasks[]
  pomodoroSessions pomodoro_sessions[]
}

model tasks {
  id        String  @id @default(uuid())
  user_id   String
  title     String
  is_active Boolean @default(false)

  created_at DateTime  @default(now()) @db.Timestamptz
  updated_at DateTime  @updatedAt @db.Timestamptz
  deleted_at DateTime? @db.Timestamptz

  // relations
  user             users               @relation(fields: [user_id], references: [id], onDelete: Cascade)
  pomodoroSessions pomodoro_sessions[]

  @@index([user_id])
}

model pomodoro_sessions {
  id String @id @default(uuid())

  user_id String
  task_id String

  state PomodoroSessionState

  focus_duration_seconds Int
  break_duration_seconds Int

  started_at DateTime  @db.Timestamptz
  ended_at   DateTime? @db.Timestamptz

  paused_at           DateTime? @db.Timestamptz
  total_pause_seconds Int       @default(0)

  created_at DateTime @default(now()) @db.Timestamptz
  updated_at DateTime @updatedAt @db.Timestamptz

  // relations
  user users @relation(fields: [user_id], references: [id], onDelete: Cascade)
  task tasks @relation(fields: [task_id], references: [id], onDelete: Restrict)

  @@index([user_id])
  @@index([user_id, started_at(sort: Desc)])
}
